<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><title>ARCHITECH ADMIN</title>
  <style>
    body { background:#111; color:#eee; font-family:monospace; padding:20px }
    h1,h2 { color:#0ff }
    table { width:100%; border-collapse:collapse; margin-bottom:1em }
    th,td { border:1px solid #333; padding:8px }
    th { background:#222 }
    input,button { padding:6px; margin:4px }
    .flex { display:flex; gap:8px; align-items:center }
  </style>
</head>
<body>
  <h1>ðŸ”’ ARCHITECH Admin Panel</h1>
  <div class="flex">
    <label>JWT: <input id="jwt" size="60" /></label>
    <button onclick="loadUsers()">Refresh Users</button>
    <button onclick="loadSessions()">Refresh Sessions</button>
  </div>

  <h2>Create New User</h2>
  <form id="createForm" onsubmit="createUser();return false;">
    <input id="u_name" placeholder="Username"/>&nbsp;
    <input id="u_pw"   placeholder="Password"/>&nbsp;
    <label>Admin<input type="checkbox" id="u_admin"/></label>&nbsp;
    <input id="u_sid"  placeholder="Twilio SID"/>&nbsp;
    <input id="u_tok"  placeholder="Twilio Token"/>&nbsp;
    <button type="submit">Create</button>
  </form>

  <h2>Users</h2>
  <table id="users">
    <thead><tr>
      <th>ID</th><th>User</th><th>Admin</th><th>Active</th>
      <th>SID</th><th>Token</th><th>Actions</th>
    </tr></thead>
    <tbody></tbody>
  </table>

  <h2>Login Sessions</h2>
  <table id="sessions">
    <thead><tr>
      <th>Session ID</th><th>User ID</th><th>IP Address</th><th>When</th>
    </tr></thead>
    <tbody></tbody>
  </table>

  <script>
    const API = window.location.origin;
    function getJWT(){ return document.getElementById('jwt').value; }
    async function loadUsers(){
      const res = await fetch(API+"/admin/users", {
        headers:{ "Authorization":"Bearer "+getJWT() }
      });
      const data = await res.json();
      const tbody = document.querySelector("#users tbody");
      tbody.innerHTML = "";
      data.forEach(u=>{
        tbody.innerHTML += `
          <tr>
            <td>${u.id}</td>
            <td>${u.username}</td>
            <td>${u.is_admin}</td>
            <td>${u.active}</td>
            <td>${u.twilio_sid||""}</td>
            <td>${u.twilio_token||""}</td>
            <td>
              <button onclick="deleteUser(${u.id})">Delete</button>
            </td>
          </tr>
        `;
      });
    }
    async function deleteUser(id){
      if(!confirm("Delete user #"+id+"?")) return;
      await fetch(API+`/admin/users/${id}`, {
        method:"DELETE",
        headers:{ "Authorization":"Bearer "+getJWT() }
      });
      loadUsers();
    }
    async function createUser(){
      const body = {
        username: document.getElementById("u_name").value,
        password: document.getElementById("u_pw").value,
        is_admin: document.getElementById("u_admin").checked,
        twilio_sid: document.getElementById("u_sid").value,
        twilio_token: document.getElementById("u_tok").value
      };
      await fetch(API+"/admin/users", {
        method:"POST",
        headers:{
          "Authorization":"Bearer "+getJWT(),
          "Content-Type":"application/json"
        },
        body: JSON.stringify(body)
      });
      document.getElementById("createForm").reset();
      loadUsers();
    }
    async function loadSessions(){
      const res = await fetch(API+"/admin/sessions", {
        headers:{ "Authorization":"Bearer "+getJWT() }
      });
      const data = await res.json();
      const tbody = document.querySelector("#sessions tbody");
      tbody.innerHTML = "";
      data.forEach(s=>{
        tbody.innerHTML += `
          <tr>
            <td>${s.id}</td>
            <td>${s.user_id}</td>
            <td>${s.ip_address}</td>
            <td>${new Date(s.timestamp).toLocaleString()}</td>
          </tr>
        `;
      });
    }
  </script>
</body>
</html>
